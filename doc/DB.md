# 1. База данных
## 1.1. Cтруктуры
### User
```
struct User {
  int id;
  bool admin;
  char login[256];
  char first_name[256];
  char last_name[256];
}
```
### Question
```
struct Question {
  int id;
  int theme;
  char value[256];
  char ans[4][256];
  int correct;
}
```
Здесь `value` - это сам текст вопроса, `ans` - массив вариантов ответа, а `correct` - индекс правильного ответа в массиве (от 0 до 3)
### Marks
```
struct Marks {
  int user_id;
  int values[10];
}
```
*values* - массив оценок по порядку следования тем (см. **Примечание** в конце). Последние 2 элемента - среднее и оценка за итоговый тест.

## 1.2. Инициализация

- `int db_open()` - открывает БД. *(Фактически, алиас для библиотечной sqlite3_open())*. Возвращает 0, если ок, -1 если не ок.
- `int db_open(char * name)` - открывает БД по имени (это перегрузка функции db_open без аргументов, просто можете либо передавать имя, либо не передавать). Возвращает 0, если ок, -1 если не ок.

> **Важно:** я не стал запариваться с проверкой существования файла, так что функция сама создаст пустую базу, если вы ошиблись в имени файла

> **Замечание:** Нельзя открыть несколько баз одновременно. 
- `void db_close()` - внезапно, закрывает БД.

## 1.3. Логин, регистрация, работа с пользователями

- `User db_login(char * login, char * password)` - возвращает объект пользователя (при ошибке - с пустыми полями). Здесь и далее password - **значение пароля, а не хэш**

> **Важно:** В отличие от первоначальной версии, теперь нет различия между авторизацией студента и преподавателя. Вам просто надо проверить поле `admin` объекта `user`, чтобы определить, давать ли юзеру права на редактирование. 

- `int db_add_user(User user, char * password)` - Добавляет нового пользователя с правами **студента** (значение поля admin и id не важно); Возвращает id пользователя, или -1 в случае ошибки
- `int db_add_admin(User user, char * password)` - Добавляет нового пользователя с правами **преподавателя** (значение полей admin и id не важно); Возвращает id пользователя, или -1 в случае ошибки 
- `int db_grant_admin(int id)` - Дает пользователю права админа. Возвращает 0, если ОК, или -1 если не ОК.
- `int db_delete_user(int id)` - Удаляет пользователя; Возвращает 0, если ОК, или -1 если не ОК.
- `User * db_get_users(int * size)` - Возвращает указатель на динамичекий массив **всех** студентов в базе (не преподавателей). Записывает длину массива в переменную size.
- `User db_get_user(int id)` - Возвращает структуру пользователя по его id (с пустыми полями если не ок);
- Фильтрация coming soon
- `Marks db_get_user_marks(int user_id)` - Возвращает объект оценок одного пользователя (c пустыми полями если не ок)
- `User * db_get_users_sorted(int * size, int by, int desc)` - Аналог `db_get_users`, но сортирует студентов по оценкам,  by - номер темы в массиве (с нуля естессна), по которой сортируем. Если desc == 0, то сортируется по возрастанию, 1 - по убыванию
- `int db_set_mark(int user_id, int theme, int mark)` - ставит пользователю с ID *user_id* оценку *mark* по теме *theme* (или *final*); Возвращает 0, если ОК, или -1 если не ОК.

## 1.4. Управление вопросами

- `Question * db_get_test(int theme)` - Возвращает массив из 10 рандомных вопросов темы *theme* (см. Примечание)
- `Question * db_get_final_test()` - Рандомит 40 вопросов из любых тем
- `Question * db_get_questions(int * size)` - Возвращает указатель на динамичекий массив **всех** вопросов в базе. Записывает длину массива в переменную size.
- `Question db_get_question_by_id(int id)` - Возвращает вопрос по id (c пустыми полями если не ок)
- `int db_add_question(Question question)` - Добавляет вопрос; Возвращает id вопроса, или -1 в случае ошибки *(Поле id структуры question не имеет значения)*
- `int db_update_question(Question question)` - Изменяет вопрос; Возвращает 0, если ОК, или -1 если не ОК.
- `int db_delete_question(int id)` - Удаляет вопрос. Возвращает 0, если ОК, или -1 если не ОК.

## 1.5. Утилиты

- `char * db_get_theme_by_id(int id)` - Получить название темы в базе по ее id *(По дефолту вернет loops)*

## 1.6. Примечание
Порядок оценок в массиве:
- \[0\] - loops
- \[1\] - arrays
- \[2\] - strings
- \[3\] - recursion
- \[4\] - structs
- \[5\] - files
- \[6\] - pointers
- \[7\] - dynamic
- \[8\] - average
- \[9\] - final
